var ibhuku = angular.module('ibhuku', ['ui.router','ng-token-auth','ui-notification']);


ibhuku.config(function($stateProvider,$urlRouterProvider,$authProvider,NotificationProvider) {
    $authProvider.configure({
            apiUrl: location.protocol + "//" + location.host
        });
    $urlRouterProvider.otherwise('/404');
    $urlRouterProvider.when('', '/home');
     NotificationProvider.setOptions({
            delay: 10000,
            startTop: 20,
            startRight: 10,
            verticalSpacing: 20,
            horizontalSpacing: 20,
            positionX: 'left',
            positionY: 'bottom'
        });
    $stateProvider

       .state('home', {
            url: '/home',
            controller:'HomeController',
            templateUrl: '<%= path_to_asset("app/views/home.html") %>'
        })

         .state('home.list', {
        url: '/list',
        templateUrl: '<%= path_to_asset("app/views/partial-home-list.html") %>',
        controller: function($scope) {
            $scope.dogs = ['Bernese', 'Husky', 'Goldendoodle'];
        }
    })

    // nested list with just some random string data
    .state('home.paragraph', {
        url: '/paragraph',
        template: 'I could sure use a drink right now.'
    })


         .state('login', {
            url: '/login',
            controller:'AuthController',
            templateUrl: '<%= path_to_asset("app/views/login.html") %>',
              onEnter: function($state, $auth) {
                $auth.validateUser().then(function (){
                    $state.go('home');
                })
            }
        })

          .state('signup', {
            url: '/signup',
            controller:'AuthController',
            templateUrl: '<%= path_to_asset("app/views/signup.html") %>',
             onEnter: function($state, $auth) {
                $auth.validateUser().then(function (){
                    $state.go('home');
                })
            }
        })

        .state('reset', {
           url: '/reset',
           controller:'AuthController',
           templateUrl: '<%= path_to_asset("app/views/reset.html") %>'
       })

       .state('update', {
          url: '/update',
          controller:'AuthController',
          templateUrl: '<%= path_to_asset("app/views/update.html") %>'
      })

            .state('product', {
            url: '/product',
            controller:'ProductController',
            templateUrl: '<%= path_to_asset("app/views/product.html") %>'
        })

              .state('products', {
            url: '/products',
            controller:'ProductsController',
            templateUrl: '<%= path_to_asset("app/views/products.html") %>'
        })

                .state('checkout', {
            url: '/checkout',
            controller:'CheckoutController',
            templateUrl: '<%= path_to_asset("app/views/checkout.html") %>'
        })


                  .state('404', {
            url: '/404',
            controller:'404Controller',
            templateUrl: '<%= path_to_asset("app/views/404.html") %>'
        })

                    .state('about', {
            url: '/about',
            controller:'AboutController',
            templateUrl: '<%= path_to_asset("app/views/about.html") %>'
        })

                      .state('contact', {
            url: '/contact',
            controller:'ContactController',
            templateUrl: '<%= path_to_asset("app/views/contact.html") %>'
        });



});



ibhuku.run(function($rootScope, $location,Notification) {
    $rootScope.$on('auth:login-success', function(ev, user) {
    $location.path('/home');
    $rootScope.signedIn = true;
    Notification.primary('Welcome '+user.email);
  });

    $rootScope.$on('auth:login-error', function(ev, user) {
        $rootScope.signedIn = false;
    Notification.error({message: 'Incorrect Login', delay: 1000});
  });

    $rootScope.$on('auth:session-expired', function(ev) {
         $rootScope.signedIn = false;
  Notification.primary('Session has expired');
});

    $rootScope.$on('auth:logout-success', function(ev) {
        $rootScope.signedIn = false;
    Notification.primary('goodbye');
});


});
